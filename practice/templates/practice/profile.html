<!DOCTYPE html>
{% load static %}
<html lang="vi-vn">
<head>
    <meta charset="UTF-8">
    <title>Quản lý tài khoản</title>
    <link rel="stylesheet" href="{% static 'users/css/button.css' %}">
    <link rel="stylesheet" href="{% static 'users/css/input.css' %}">
    <link rel="stylesheet" href="{% static 'users/css/only_a_form.css' %}">
    <link rel="stylesheet" href="{% static 'users/css/show_notification_dialog.css' %}">
</head>
<body>
    {% if notification and not data.readonly %}
        <dialog id="show_notification_dialog">
            <div>
                <h2 class="native">Thông báo</h2>
                <p class="native">{{notification}}</p>
                <a autofocus class="button" href="{% url 'practice:view_profile' request.user.id %}">OK</a>
            </div>
        </dialog>
    {% endif %}

    <main>
        {% if data.readonly %}
            {% if user.role == 'Admin' and profile_role != 'Admin' %}
            <form method="POST" action="{% url 'practice:process_user_by_admin' profile_id %}">
            {% else %}
            <form>
            {% endif %}
                <h2 style="width:100%;">Thông tin hồ sơ</h2>
                <div style="width:100%;">
                    <p><strong>{{data.code.label}}: </strong>{{data.code.value}}</p>
                </div >
                <div style="width:100%;">
                    <p><strong>{{data.name.label}}: </strong>{{data.name.value}}</p>
                </div>
                <div style="width:100%;">
                    <p><strong>{{data.email.label}}: </strong>{{data.email.value}}</p>
                </div>
                {% if user.role == 'Admin' and profile_role != 'Admin' %}
                    <div>
                            {% csrf_token %}
                            {% if not profile_locked %}
                                <input type="hidden" name="lock" value="on">
                                <button type="submit">Khóa</button>
                            {% else %}
                                <input type="hidden" name="unlock" value="on">
                                <button type="submit">Mở khóa</button>
                            {% endif %}
                    </div>
                {% endif %}
                <div>
                    <p id="id__previous_adjacent_link">
                        {% if data.previous_adjacent_url %}
                        <noscript>
                            <a href="{{data.previous_adjacent_url}}">Tới trang trước</a>
                        </noscript>
                        {% endif %}
                    </p>
                    <script>
                        if (history.length > 1) {
                            const previous_adjacent_p = document.querySelector("p#id__previous_adjacent_link");
                            const previous_adjacent_a = document.createElement("a");
                            previous_adjacent_a.innerText = "Trở lại trang trước";
                            previous_adjacent_a.setAttribute("href", "#id_previous_adjacent_link");
                            previous_adjacent_a.setAttribute("onclick", "history.back();");
                            previous_adjacent_p.innerText = "";
                            previous_adjacent_p.appendChild(previous_adjacent_a);
                        }
                    </script>
                </div>
            </form>
        {% else %}
        <form method="POST">
            <h2>Quản lý tài khoản</h2>
            {% csrf_token %}
            <p style="width:100%;"><strong>{{data.code.label}}: </strong>{{data.code.value}}</p>
            <div>
                <label for="id_name"><strong>{{data.name.label}}:</strong></label>
                <input required
                       type="text" spellcheck="false"
                       id="id_name"
                       name="name"
                       placeholder="{{data.name.label}}"
                       title="{{data.name.label}}"
                       value="{{data.name.value}}"
                       class="{%if data.name.errors %} error {% endif %}"/>
                {% for error in data.name.errors %}
                    <p class="error" ref="id_name">{{error}}</p>
                {% endfor %}
            </div>
            <div>
                <label for="id_email"><strong>{{data.email.label}}:</strong></label>
                <input required
                       type="text" spellcheck="false"
                       id="id_email"
                       name="email"
                       placeholder="{{data.email.label}}"
                       title="{{data.email.label}}"
                       value="{{data.email.value}}"
                       class="{% if data.email.errors %}error{% endif %}"/>
                {% for error in data.email.errors %}
                    <p class="error" ref="id_email">{{error}}</p>
                {% endfor %}
            </div>
            {% for error in data.errors %}
                <p ref>{{error}}</p>
            {% endfor %}
            <div style="position:relative;">
                <button type="submit">Lưu sửa đổi</button>
                <p id="id_previous_adjacent_link">
                    {% if data.previous_adjacent_url %}
                    <noscript>
                        <a href="{{data.previous_adjacent_url}}">Tới trang trước</a>
                    </noscript>
                    {% endif %}
                </p>
                <script>
                    if (history.length > 1) {
                        const previous_adjacent_p = document.querySelector("p#id_previous_adjacent_link");
                        const previous_adjacent_a = document.createElement("a");
                        previous_adjacent_a.innerText = "Trở lại trang trước";
                        previous_adjacent_a.setAttribute("href", "#id_previous_adjacent_link");
                        previous_adjacent_a.setAttribute("onclick", "history.back();");
                        previous_adjacent_p.innerText = "";
                        previous_adjacent_p.appendChild(previous_adjacent_a);
                    }
                </script>
            </div>
        </form>
        {% endif %}
    </main>

    {% if not data.readonly %}
        <script src="{% static 'users\js\input.js' %}"></script>
    {% endif %}
</body>
</html>